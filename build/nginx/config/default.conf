fastcgi_cache_key "$scheme$request_method$host$request_uri";
fastcgi_cache_use_stale error timeout invalid_header http_500;
fastcgi_ignore_headers Cache-Control Expires Set-Cookie;
fastcgi_cache_path /var/cache/nginx levels=1:2 keys_zone=wordpress:100m inactive=60m;

server {
  listen 80 default_server;
  listen [::]:80 default_server ipv6only=on;

  server_name localhost;
  root /var/www/html;
  index index.php;

  include global/headers.conf;
  include global/gzip.conf;
  include global/cache/fastcgi-cache.conf;
  include global/restrictions.conf;
  include global/wordpress.conf;

  resolver 127.0.0.11 ipv6=off valid=60s;
  set $upstream php:9000;

  location ~ \.php$ {
    try_files $uri =404;

    include fastcgi_params;

    fastcgi_cache_bypass $skip_cache;
    fastcgi_no_cache $skip_cache;
    fastcgi_cache wordpress;
    fastcgi_cache_valid 60m;

    fastcgi_read_timeout 360s;
    fastcgi_buffer_size 128k;
    fastcgi_buffers 4 256k;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;

    fastcgi_pass $upstream;

    fastcgi_index index.php;
    fastcgi_intercept_errors on;
  }
}